@page
@model SmartAuditDemo.Pages.Documents.IndexModel
@{
    ViewData["Title"] = "Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø³Ù†Ø§Ø¯";
}

<div class="page-header">
    <h1 class="page-title">Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø³Ù†Ø§Ø¯</h1>
    <p class="page-description">Ù…Ø¯ÛŒØ±ÛŒØª Ùˆ Ø³Ø§Ø²Ù…Ø§Ù†Ø¯Ù‡ÛŒ Ø§Ø³Ù†Ø§Ø¯ Ø­Ø³Ø§Ø¨Ø±Ø³ÛŒ</p>
</div>

<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">Ø¬Ø³ØªØ¬Ùˆ Ùˆ ÙÛŒÙ„ØªØ±</h5>
    </div>
    <div class="card-body">
        <form method="get" id="filterForm">
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø³Ù†Ø¯</label>
                    <input type="text" class="form-control" name="title" value="@Model.Filter.Title" />
                </div>
                <div class="col-md-3">
                    <label class="form-label">Ù†ÙˆØ¹ Ø³Ù†Ø¯</label>
                    <select class="form-select" name="documentType">
                        <option value="">Ù‡Ù…Ù‡</option>
                        <option value="1" selected="@(Model.Filter.DocumentType == DocumentType.Voucher)">Ø³Ù†Ø¯ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ</option>
                        <option value="2" selected="@(Model.Filter.DocumentType == DocumentType.Invoice)">ÙØ§Ú©ØªÙˆØ± ÛŒØ§ ØµÙˆØ±ØªØ­Ø³Ø§Ø¨</option>
                        <option value="3" selected="@(Model.Filter.DocumentType == DocumentType.Contract)">Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</option>
                        <option value="4" selected="@(Model.Filter.DocumentType == DocumentType.Letter)">Ù…Ú©Ø§ØªØ¨Ø§Øª</option>
                        <option value="5" selected="@(Model.Filter.DocumentType == DocumentType.Report)">Ú¯Ø²Ø§Ø±Ø´Ø§Øª</option>
                        <option value="6" selected="@(Model.Filter.DocumentType == DocumentType.Ledger)">Ø¯ÙØ§ØªØ±</option>
                        <option value="7" selected="@(Model.Filter.DocumentType == DocumentType.Other)">Ø³Ø§ÛŒØ±</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Ø§Ú©Ø³ØªÙ†Ø´Ù†</label>
                    <input type="text" class="form-control" name="extension" value="@Model.Filter.Extension" placeholder="pdf, doc, xls" />
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100 me-2">Ø¬Ø³ØªØ¬Ùˆ</button>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <a href="/Documents" class="btn btn-secondary w-100">Ø±ÛŒØ³Øª</a>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Ù„ÛŒØ³Øª Ø§Ø³Ù†Ø§Ø¯</h5>
        <a asp-page="./Create" class="btn btn-success btn-sm">
            <i class="me-1">â•</i> Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯ÛŒØ¯
        </a>
    </div>
    <div class="card-body">
        @if (Model.DocumentsByType != null && Model.DocumentsByType.Any())
        {
            <div class="accordion" id="documentsAccordion">
                @foreach (var group in Model.DocumentsByType)
                {
                    var accordionId = $"accordion-{group.Key}";
                    var collapseId = $"collapse-{group.Key}";
                    var documentTypeName = GetDocumentTypeName(group.Key);
                    var icon = GetDocumentTypeIcon(group.Key);
                    
                    <div class="accordion-item mb-3">
                        <h2 class="accordion-header" id="@accordionId">
                            <button class="accordion-button @(group.Key == Model.DocumentsByType.First().Key ? "" : "collapsed")" type="button" 
                                    data-bs-toggle="collapse" data-bs-target="#@collapseId" 
                                    aria-expanded="@(group.Key == Model.DocumentsByType.First().Key ? "true" : "false")">
                                <span class="me-2">@icon</span>
                                <strong>@documentTypeName</strong>
                                <span class="badge bg-purple ms-2">@group.Value.Count</span>
                            </button>
                        </h2>
                        <div id="@collapseId" class="accordion-collapse collapse @(group.Key == Model.DocumentsByType.First().Key ? "show" : "")" 
                             data-bs-parent="#documentsAccordion">
                            <div class="accordion-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>Ù†Ø§Ù… Ø³Ù†Ø¯</th>
                                                <th>Ø§Ú©Ø³ØªÙ†Ø´Ù†</th>
                                                <th>Ø­Ø¬Ù…</th>
                                                <th>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª</th>
                                                <th>Ú©Ø§Ø±Ø¨Ø± Ø«Ø¨Øªâ€ŒÚ©Ù†Ù†Ø¯Ù‡</th>
                                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var doc in group.Value)
                                            {
                                                <tr>
                                                    <td>@doc.Title</td>
                                                    <td><span class="badge bg-info">@doc.Extension.ToUpper()</span></td>
                                                    <td>@doc.SizeFormatted</td>
                                                    <td>@doc.CreatedAt.ToString("yyyy/MM/dd HH:mm")</td>
                                                    <td>@doc.UploaderUserName</td>
                                                    <td>
                                                        <div class="btn-group btn-group-sm" role="group">
                                                            <a asp-page="./Details" asp-route-id="@doc.Id" class="btn btn-info" title="Ù…Ø´Ø§Ù‡Ø¯Ù‡">
                                                                <i>ğŸ‘ï¸</i>
                                                            </a>
                                                            <a href="@doc.FileUrl" target="_blank" class="btn btn-primary" title="Ø¯Ø§Ù†Ù„ÙˆØ¯">
                                                                <i>â¬‡ï¸</i>
                                                            </a>
                                                            <a asp-page="./Edit" asp-route-id="@doc.Id" class="btn btn-warning" title="ÙˆÛŒØ±Ø§ÛŒØ´">
                                                                <i>âœï¸</i>
                                                            </a>
                                                            <a asp-page="./Delete" asp-route-id="@doc.Id" class="btn btn-danger" title="Ø­Ø°Ù">
                                                                <i>ğŸ—‘ï¸</i>
                                                            </a>
                                                        </div>
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>

            @if (Model.Documents?.TotalPages > 1)
            {
                <nav aria-label="ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ" class="mt-4">
                    <ul class="pagination justify-content-center">
                        @if (Model.Documents.HasPreviousPage)
                        {
                            <li class="page-item">
                                <a class="page-link" href="?pageNumber=@(Model.Documents.PageNumber - 1)&title=@Model.Filter.Title&documentType=@((int?)Model.Filter.DocumentType)&extension=@Model.Filter.Extension">Ù‚Ø¨Ù„ÛŒ</a>
                            </li>
                        }
                        @for (int i = 1; i <= Model.Documents.TotalPages; i++)
                        {
                            <li class="page-item @(i == Model.Documents.PageNumber ? "active" : "")">
                                <a class="page-link" href="?pageNumber=@i&title=@Model.Filter.Title&documentType=@((int?)Model.Filter.DocumentType)&extension=@Model.Filter.Extension">@i</a>
                            </li>
                        }
                        @if (Model.Documents.HasNextPage)
                        {
                            <li class="page-item">
                                <a class="page-link" href="?pageNumber=@(Model.Documents.PageNumber + 1)&title=@Model.Filter.Title&documentType=@((int?)Model.Filter.DocumentType)&extension=@Model.Filter.Extension">Ø¨Ø¹Ø¯ÛŒ</a>
                            </li>
                        }
                    </ul>
                </nav>
            }
        }
        else
        {
            <div class="alert alert-info text-center">
                <p class="mb-0">Ù‡ÛŒÚ† Ø³Ù†Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>
            </div>
        }
    </div>
</div>

@functions {
    private string GetDocumentTypeName(DocumentType type)
    {
        return type switch
        {
            DocumentType.Voucher => "Ø³Ù†Ø¯ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ",
            DocumentType.Invoice => "ÙØ§Ú©ØªÙˆØ± ÛŒØ§ ØµÙˆØ±ØªØ­Ø³Ø§Ø¨",
            DocumentType.Contract => "Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯",
            DocumentType.Letter => "Ù…Ú©Ø§ØªØ¨Ø§Øª",
            DocumentType.Report => "Ú¯Ø²Ø§Ø±Ø´Ø§Øª",
            DocumentType.Ledger => "Ø¯ÙØ§ØªØ±",
            DocumentType.Other => "Ø³Ø§ÛŒØ±",
            _ => type.ToString()
        };
    }

    private string GetDocumentTypeIcon(DocumentType type)
    {
        return type switch
        {
            DocumentType.Voucher => "ğŸ“‹",
            DocumentType.Invoice => "ğŸ§¾",
            DocumentType.Contract => "ğŸ“„",
            DocumentType.Letter => "âœ‰ï¸",
            DocumentType.Report => "ğŸ“Š",
            DocumentType.Ledger => "ğŸ“š",
            DocumentType.Other => "ğŸ“",
            _ => "ğŸ“„"
        };
    }
}

@section Scripts {
    <script>
        @if (TempData["SuccessMessage"] != null)
        {
            <text>
            showToast('@TempData["SuccessMessage"]', 'success');
            </text>
        }
        @if (TempData["ErrorMessage"] != null)
        {
            <text>
            showToast('@TempData["ErrorMessage"]', 'error');
            </text>
        }

        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `alert alert-${type === 'success' ? 'success' : 'danger'} position-fixed top-0 start-50 translate-middle-x mt-3`;
            toast.style.zIndex = '9999';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
    </script>
}
